<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NXT Ship Customer Dashboard</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f6fb;

      overflow-x: hidden;
      overflow-y: auto;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      height: 100vh;
      background: linear-gradient(to bottom, #06142f, #0b234d);
      padding: 25px;
      color: white;

      position: fixed;
      top: 0;
      left: 0;

      overflow-y: auto;
      z-index: 1000;

      transform: translateX(-100%);
      transition: transform 0.35s ease-in-out;
    }

    .sidebar::-webkit-scrollbar {
      width: 0px;
    }



    /* Sidebar Open Animation */
    .sidebar.open {
      transform: translateX(0);
      box-shadow: 4px 0 20px rgba(0, 0, 0, 0.4);
    }

    /* Desktop Mode */
    @media(min-width: 801px) {
      .sidebar {
        transform: translateX(0);
      }

      .main {
        margin-left: 260px;
      }
    }

    .sidebar h2 {
      font-size: 22px;
      margin-bottom: 25px;
      font-weight: bold;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      z-index: 900;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease;
    }

    .overlay.show {
      opacity: 1;
      visibility: visible;
    }

    body.menu-open {
      overflow: hidden;
    }

    .menu-item {
      padding: 14px;
      margin: 8px 0;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 16px;
      transition: 0.25s;
    }

    .menu-item:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateX(5px);
    }

    .menu-item.active {
      background: rgba(255, 255, 255, 0.25);
    }

    /* Main Content */
    .main {
      width: 100%;
      padding: 50px;
      transition: margin-left 0.3s ease;
    }

    .topbar {
      background: white;
      padding: 15px 20px;
      border-radius: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }

    .topbar h1 {
      font-size: 22px;
      margin: 0;
    }

    .content-box {
      margin-top: 25px;
      background: white;
      padding: 25px;
      border-radius: 15px;
      min-height: 450px;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);

      animation: fadeIn 0.3s ease;
    }

    /* Fade Animation */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(8px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    input,
    button,
    textarea {
      padding: 10px;
      margin: 8px 0;
      width: 90%;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 15px;
    }

    button {
      background: #2563eb;
      color: white;
      border: none;
      cursor: pointer;
      width: auto;
      padding: 10px 18px;
    }

    button:hover {
      opacity: 0.85;
    }

    /* Mobile Menu Button */
    .menu-btn {
      display: none;
      font-size: 22px;
      background: #2563eb;
      color: white;
      padding: 10px 15px;
      border-radius: 10px;
      cursor: pointer;
    }

    .tx-item {
      background: #f4f6fb;
      padding: 12px;
      border-radius: 10px;
      margin: 8px 0;
      font-size: 14px;
    }

    .custom-popup {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
    }

    .popup-box {
      background: white;
      padding: 14px 18px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      animation: slideIn 0.3s ease;
    }

    .popup-box.success {
      border-left: 5px solid #16a34a;
    }
    .popup-box.error {
      border-left: 5px solid #dc2626;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(50px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* Mobile Responsive */
    @media(max-width: 800px) {
      .menu-btn {
        display: block;
      }

      .main {
        margin-left: 0 !important;
        padding: 1px;
      }
    }
  </style>
</head>

<body>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <h2>ğŸš€ NXT Ship</h2>

    <div class="menu-item active" onclick="loadSection('dashboard', this)">ğŸ  Dashboard</div>
    <div class="menu-item" onclick="loadSection('track', this)">ğŸ“¦ Track Orders</div>
    <div class="menu-item" onclick="loadSection('shipment', this)">â• Create Shipment</div>
    <div class="menu-item" onclick="loadSection('rate', this)">ğŸ’° Rate Calculator</div>
    <div class="menu-item" onclick="loadSection('courier', this)">ğŸšš Courier Services</div>
    <div class="menu-item" onclick="loadSection('international', this)">ğŸŒ International Shipping</div>
    <div class="menu-item" onclick="loadSection('logistics', this)">ğŸ¢ Ecommerce Logistics</div>
    <div class="menu-item" onclick="loadSection('wallet', this)">ğŸ‘› Wallet</div>
    <div class="menu-item" onclick="loadSection('reports', this)">ğŸ“Š Reports</div>
    <div class="menu-item" onclick="loadSection('resources', this)">ğŸ“‘ Resources</div>
    <div class="menu-item" onclick="loadSection('support', this)">ğŸ« Support Tickets</div>
    <div class="menu-item" onclick="loadSection('profile', this)">ğŸ‘¤ Profile</div>
    <div class="menu-item" onclick="loadSection('settings', this)">âš™ï¸ Settings</div>
    <div class="menu-item" onclick="logout()">ğŸšª Logout</div>
  </div>

  <div class="overlay" onclick="closeMenu()"></div>

  <!-- Main Area -->
  <div class="main">

    <!-- Topbar -->
    <div class="topbar">
      <span class="menu-btn" onclick="toggleMenu()">â˜°</span>
      <h1 id="pageTitle">Dashboard</h1>
      <div id="customerName">Welcome ğŸ‘‹</div>
    </div>

    <!-- Dynamic Content -->
    <div class="content-box" id="contentArea"></div>
  </div>

  <script>
    console.log("ğŸš€ Dashboard Script Loaded...");

    // âœ… Token Check
    const token = localStorage.getItem("customerToken");
    const customerData = JSON.parse(localStorage.getItem("customerData"));

    if (!token) {
      console.log("âŒ No Token Found, Redirecting...");
      window.location.href = "login.html";
    }

    // âœ… Show Customer Name
    if (customerData) {
      document.getElementById("customerName").innerText =
        "Hello, " + customerData.name + " ğŸ‘‹";
    }

    // âœ… Set Active Sidebar Item
    function setActive(element) {
      document.querySelectorAll(".menu-item").forEach(item =>
        item.classList.remove("active")
      );
      if (element) element.classList.add("active");
    }

    // âœ… Toggle Mobile Menu
    function toggleMenu() {
      console.log("ğŸ“± Toggling Mobile Menu...");

      const sidebar = document.getElementById("sidebar");
      const overlay = document.querySelector(".overlay");

      if (!sidebar) {
        console.error("âŒ Sidebar Element Not Found");
        return;
      }

      sidebar.classList.toggle("open");
      overlay.classList.toggle("show");

      console.log("ğŸ“Œ Sidebar State:", sidebar.classList.contains("open") ? "Open" : "Closed");
    }

    function closeMenu() {
      const sidebar = document.getElementById("sidebar");
      const overlay = document.querySelector(".overlay");

      sidebar.classList.remove("open");
      overlay.classList.remove("show");

      console.log("ğŸ“Œ Mobile Menu Closed");
      document.body.classList.remove("menu-open");
    }

    // âœ… Dashboard Default Content
    function loadDashboard() {
      document.getElementById("pageTitle").innerText = "Dashboard";

      document.getElementById("contentArea").innerHTML = `
      <h2>ğŸ  Dashboard Overview</h2>
      <p>Welcome to your NXT Ship Customer Panel ğŸš€</p>

      <!-- Quick Features -->
      <div class="quick-box">
        <p>ğŸ“¦ Track all shipments easily</p>
        <p>â• Create new shipments instantly</p>
        <p>ğŸ’° Calculate courier rates</p>
        <p>ğŸ‘› Wallet & Payments system</p>
        <p>ğŸ« Support ticket management</p>
      </div>
    `;
    }

    // âœ… Load Sections Dynamically
    function loadSection(section, element) {
      console.log("ğŸ“Œ Loading Section:", section);

      if (window.innerWidth <= 801) {
        closeMenu();
      }

      setActive(element);

      const content = document.getElementById("contentArea");

      switch (section) {

        case "dashboard":
          loadDashboard();
          break;

        case "track":
          document.getElementById("pageTitle").innerText = "Track Orders";

          content.innerHTML = `
          <h2>ğŸ“¦ Track Orders</h2>
          <input id="awb" placeholder="Enter Tracking ID (AWB)" />
          <button onclick="trackOrder()">Track Now</button>
          <div id="trackResult"></div>

          <!-- à¤¯à¤¹à¤¾à¤ Backend API à¤¸à¥‡ Tracking Result à¤†à¤à¤—à¤¾ -->
        `;
          break;

        case "shipment":
          document.getElementById("pageTitle").innerText = "Create Shipment";

          content.innerHTML = `
          <h2>â• Create Shipment</h2>

          <!-- Shipment Form Placeholder -->
          <input placeholder="Receiver Name"/>
          <input placeholder="Receiver Address"/>
          <input placeholder="Pincode"/>
          <input placeholder="City"/>

          <button>Create Shipment</button>

          <p style="color:gray;">
            Backend integration next step ğŸ”¥
          </p>
        `;
          break;

        case "rate":
          document.getElementById("pageTitle").innerText = "Rate Calculator";

          content.innerHTML = `
          <h2>ğŸ’° Rate Calculator</h2>

          <!-- Rate Calculation Placeholder -->
          <input placeholder="Enter Weight (kg)"/>
          <input placeholder="Enter Destination Pincode"/>

          <button>Calculate Rate</button>
        `;
          break;

        case "courier":
          document.getElementById("pageTitle").innerText = "Courier Services";

          content.innerHTML = `
          <h2>ğŸšš Courier Services</h2>

          <!-- Courier Partner List à¤†à¤à¤—à¥€ -->
          <p>Available courier partners will show here.</p>
        `;
          break;

        case "international":
          document.getElementById("pageTitle").innerText = "International Shipping";

          content.innerHTML = `
          <h2>ğŸŒ International Shipping</h2>

          <!-- International Options Placeholder -->
          <p>International shipping options coming soon.</p>
        `;
          break;

        case "logistics":
          document.getElementById("pageTitle").innerText = "Ecommerce Logistics";

          content.innerHTML = `
          <h2>ğŸ¢ Ecommerce Logistics</h2>

          <!-- Bulk Shipping + Warehouse -->
          <p>Warehousing + Bulk shipping solutions will appear here.</p>
        `;
          break;

        case "wallet":
          document.getElementById("pageTitle").innerText = "Wallet";

          content.innerHTML = `
          <h2>ğŸ‘› Wallet</h2>

          <!-- Wallet Balance Dynamic -->
          <div class="wallet-box">
            Wallet Balance: â‚¹<span id="walletBalance">Loading...</span>
          </div>

          <input id="addAmount" placeholder="Enter Amount to Add" />
          <button onclick="addMoneyToWallet()">Add Money</button>

          <h3>ğŸ“ˆ Transaction History</h3>
          <div id="transactionList">Loading transactions...</div>
        `;

          // Wallet Balance
          async function loadWalletBalance() {
            console.log("ğŸ’° Fetching Wallet Balance...");
            // Simulate API Call
            try {
              const res = await fetch("https://nxtship-backend.onrender.com/api/wallet/balance", {

                method: "GET",
                headers: {
                  "Authorization": `Bearer ${localStorage.getItem("customerToken")}`,
                },
              });
              const data = await res.json();

              console.log("ğŸ“Œ Wallet API Response:", data);

              if (!res.ok) {
                console.error("âŒ wallet fetch failed:", data.message || "Unknown error");
                return;
              }

              const balance = data.walletBalance || data.balance || "0.00";

              console.log("âœ… Wallet Balance Fetched:", balance);

              document.getElementById("walletBalance").innerText = balance;
            } catch (err) {
              console.error("âŒ Error fetching wallet balance:", err);
              document.getElementById("walletBalance").innerText = "Error";
            }
          }

          loadWalletBalance();
          setInterval(loadWalletBalance, 30000); // Refresh every 30 seconds
          break;

        case "reports":
          document.getElementById("pageTitle").innerText = "Reports";

          content.innerHTML = `
          <h2>ğŸ“Š Reports</h2>

          <!-- Reports Placeholder -->
          <p>Monthly shipment analytics will appear here.</p>
        `;
          break;

        case "resources":
          document.getElementById("pageTitle").innerText = "Resources";

          content.innerHTML = `
          <h2>ğŸ“‘ Resources</h2>

          <!-- Documents & Downloads -->
          <p>Download invoices, labels, documents here.</p>
        `;
          break;

        case "support":
          document.getElementById("pageTitle").innerText = "Support Tickets";

          content.innerHTML = `
          <h2>ğŸ« Support Tickets</h2>

          <!-- Ticket Form -->
          <textarea placeholder="Write your issue..."></textarea>
          <button>Submit Ticket</button>
        `;
          break;

        case "profile":
          document.getElementById("pageTitle").innerText = "Profile";

          if (!customerData) {
            content.innerHTML = `<p>âŒ Customer Data Missing</p>`;
            return;
          }

          content.innerHTML = `
          <h2>ğŸ‘¤ Profile</h2>

          <p><b>Name:</b> ${customerData.name}</p>
          <p><b>Email:</b> ${customerData.email}</p>
          <p><b>Phone:</b> ${customerData.phone}</p>
        `;
          break;

        case "settings":
          document.getElementById("pageTitle").innerText = "Settings";

          content.innerHTML = `
          <h2>âš™ï¸ Settings</h2>

          <!-- Account Settings Placeholder -->
          <p>Account settings will appear here.</p>
        `;
          break;

        default:
          content.innerHTML = `<h2>âŒ Section Not Found</h2>`;
      }
    }

    async function addMoneyToWallet() {

      const amount = Number(document.getElementById("addAmount").value);
      if (!amount || amount <= 0) {
        return showtoast("Please enter a valid amount to add.");
      }

      try {
        const res = await fetch("https://nxtship-backend.onrender.com/api/wallet/add-funds", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${localStorage.getItem("customerToken")}`,
          },
          body: JSON.stringify({ amount }),
        });

        const data = await res.json();
        console.log("ğŸ“Œ Add Money API Response:", data);

        showPopup("ğŸ’° " + (data.message || "Money Added Successfully!"));
        document.getElementById("walletBalance").innerText = data.balance;

        // Refresh transaction history after adding money
        loadTransactions();
      }
      catch (err) {
        console.log("âŒ Error adding money to wallet:", err);
        showPopup("Error adding money. Please try again.");
      }
    }

    // Transaction History Load

    async function loadTransactions() {
      console.log("ğŸ“ˆ Fetching Transaction History...");
      try {
        const res = await fetch("https://nxtship-backend.onrender.com/api/wallet/transactions", {
          method: "GET",
          headers: {
            Authorization: `Bearer ${localStorage.getItem("customerToken")}`,
          },
        });
        const data = await res.json();

        console.log("ğŸ“Œ Transactions API Response:", data);

        const list = document.getElementById("transactionList");

        if (!data.transactions.length) {
          list.innerHTML = "<p>No transactions found.</p>";
          return;
        }

        list.innerHTML = data.transactions.map(tx => `
                <div class="tx-item">
                  <b>â‚¹${tx.amount}</b> - ${tx.message}<br/>
                  <small>${new Date(tx.date).toLocaleString()}</small>
                </div>
              `)
          .join("");
      } catch (err) {
        console.error("âŒ Error fetching transactions:", err);
        document.getElementById("transactionList").innerHTML = "<p style='color:red;'>Error loading transactions.</p>";
      }
    }

    function showPopup(message, type = "success") {
      
      const oldPopup = document.querySelector(".custom-popup");
      if (oldPopup) oldPopup.remove();

      const popup = document.createElement("div");
      popup.className = "custom-popup ";

      popup.innerHTML = `
       <div class="popup-box ${type}">
         <p>${message}</p>
        </div>
      `;
      document.body.appendChild(popup);

      setTimeout(() => {
        popup.remove();
      }, 3000);
    }


    // âœ… Track Order Dummy
    function trackOrder() {
      const awb = document.getElementById("awb").value;

      document.getElementById("trackResult").innerHTML =
        "<p>ğŸ“Œ Backend Tracking API Next Step ğŸ”¥</p>";

      console.log("Tracking AWB:", awb);
    }


    // âœ… Logout
    function logout() {
      console.log("ğŸšª Logging Out...");

      localStorage.removeItem("customerToken");
      localStorage.removeItem("customerData");

      window.location.href = "login.html";
    }

    // âœ… Default Load Dashboard on Page Open
    window.onload = () => {
      console.log("âœ… Dashboard Loaded Successfully");
      loadDashboard();
    };
  </script>

</body>

</html>